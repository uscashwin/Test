<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NFC Contact Card Generator</title>
<style>
  :root { color-scheme: light dark; --bg:#0b0b0c; --card:#141417; --ink:#eaeaf0; --muted:#9aa0aa; --accent:#4f8cff; --ok:#2fbf71; --bad:#ff6b6b; --border:#2a2a33; }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif; background: var(--bg); color: var(--ink); }
  .wrap { max-width: 840px; margin: 40px auto; padding: 0 16px; }
  h1 { font-size: 1.6rem; margin: 0 0 16px; }
  .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  .full { grid-column: 1 / -1; }
  label { font-size: .9rem; color: var(--muted); display:block; margin-bottom:6px; }
  input, select, textarea {
    width: 100%; background: var(--card); color: var(--ink); border: 1px solid var(--border);
    padding: 10px 12px; border-radius:12px; outline: none; font-size: 0.95rem;
  }
  textarea { min-height: 90px; resize: vertical; }
  .btn {
    display:inline-flex; align-items:center; gap:8px; padding: 10px 14px; border-radius:12px; border:1px solid var(--border);
    background: #1c1c22; color: var(--ink); cursor:pointer; font-weight:600; text-decoration:none;
  }
  .btn.primary { background: var(--accent); color:white; border-color: transparent; }
  .btn.ghost { background: transparent; }
  .row { display:flex; gap:10px; flex-wrap: wrap; align-items: center; }
  .note { color: var(--muted); font-size: 0.9rem; }
  .card {
    background: linear-gradient(180deg, #17171c, #121217);
    border: 1px solid var(--border); border-radius: 16px; padding: 18px; display:flex; gap:16px; align-items:center;
  }
  .avatar { width: 96px; height: 96px; border-radius: 12px; object-fit: cover; border:1px solid var(--border); background:#0e0e12; }
  .kv { display:grid; grid-template-columns: 120px 1fr; gap: 8px 12px; margin-top:8px; }
  .k { color: var(--muted); }
  .v a { color: var(--accent); text-decoration:none; }
  .pill { display:inline-block; padding: 2px 8px; border:1px solid var(--border); border-radius:999px; margin: 0 6px 6px 0; font-size:.85rem; color: var(--ink); }
  .hidden { display:none !important; }
  .len { font-variant-numeric: tabular-nums; font-weight: 700; }
  .ok { color: var(--ok); } .bad { color: var(--bad); }
  .footer { margin-top: 16px; font-size: .85rem; color: var(--muted); }
</style>
</head>
<body>
<div class="wrap">
  <h1>NFC Contact Card</h1>

  <!-- Generator Panel -->
  <section id="generator">
    <p class="note">Paste a <strong>Postimg direct link</strong> (ends with an image extension), fill details, then generate your shareable, view-only URL for your NFC tag.</p>
    <div class="grid">
      <div class="full">
        <label for="img">Profile picture (Postimg direct link)</label>
        <input id="img" type="url" placeholder="https://i.postimg.cc/xxxxxx/your-photo.jpg" />
      </div>

      <div>
        <label for="name">Full name</label>
        <input id="name" type="text" placeholder="Ada Lovelace" />
      </div>
      <div>
        <label for="grade">Grade level</label>
        <select id="grade">
          <option value="">Select…</option>
          <option value="Undergrad">Undergrad</option>
          <option value="Masters">Masters</option>
          <option value="PhD">PhD</option>
        </select>
      </div>

      <div>
        <label for="univ">University</label>
        <input id="univ" type="text" placeholder="University of Example" />
      </div>
      <div>
        <label for="major">Major</label>
        <input id="major" type="text" placeholder="Aerospace Engineering" />
      </div>

      <div>
        <label for="phone">Phone</label>
        <input id="phone" type="tel" placeholder="+1 555-123-4567" />
      </div>
      <div>
        <label for="email">Email</label>
        <input id="email" type="email" placeholder="you@example.edu" />
      </div>

      <div class="full">
        <label for="interests">Interests (comma-separated)</label>
        <textarea id="interests" placeholder="Propulsion, Systems Engineering, Robotics"></textarea>
      </div>

      <div class="full">
        <label for="linkedin">LinkedIn URL</label>
        <input id="linkedin" type="url" placeholder="https://www.linkedin.com/in/your-handle/" />
      </div>
    </div>

    <div class="row" style="margin-top:14px;">
      <button class="btn primary" id="generateBtn">Generate URL</button>
      <button class="btn ghost" id="clearBtn" type="button">Clear</button>
      <span class="note">Length: <span id="len" class="len">0</span> / 482</span>
    </div>

    <div id="result" class="row" style="margin-top:12px; gap:8px;">
      <input id="urlOut" readonly style="flex:1; min-width: 260px; background: var(--card); color: var(--ink); border:1px solid var(--border); padding:10px 12px; border-radius:12px;" />
      <button class="btn" id="copyBtn" type="button">Copy</button>
    </div>

    <p class="note footer" id="assist">
      Tip: If your link is too long, shorten “Interests”, university, or major wording. The data is compressed into the hash (<code>#</code>) so the page is always view-only when shared.
    </p>
  </section>

  <!-- Viewer Panel (read-only card) -->
  <section id="viewer" class="hidden">
    <div id="card" class="card">
      <img id="v_img" class="avatar" alt="Profile" src="" onerror="this.src=''; this.style.display='none';" />
      <div style="flex:1;">
        <div style="display:flex; align-items:baseline; gap:10px; flex-wrap: wrap;">
          <div id="v_name" style="font-size:1.25rem; font-weight:700;"></div>
          <div id="v_grade" class="pill"></div>
        </div>
        <div class="kv">
          <div class="k">University</div><div class="v" id="v_univ"></div>
          <div class="k">Major</div>    <div class="v" id="v_major"></div>
          <div class="k">Phone</div>    <div class="v" id="v_phone"></div>
          <div class="k">Email</div>    <div class="v" id="v_email"></div>
          <div class="k">LinkedIn</div> <div class="v" id="v_linkedin"></div>
        </div>
        <div id="v_interests_wrap" style="margin-top:10px;">
          <div class="k" style="margin-bottom:6px;">Interests</div>
          <div id="v_interests"></div>
        </div>
      </div>
    </div>
    <p class="note footer">This card is view-only. To create your own, open the page without the <code>#…</code> part.</p>
  </section>
</div>

<script>
/*! LZ-String (MIT) – compressToEncodedURIComponent / decompressFromEncodedURIComponent (minified) */
var LZString=function(){function o(o,r){if(!t[o]){t[o]={};for(var n=0;n<o.length;n++)t[o][o.charAt(n)]=n}return t[o][r]}var r=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",t={},e={compressToEncodedURIComponent:function(r){return null==r?"":e._compress(r,6,function(o){return n.charAt(o)})},decompressFromEncodedURIComponent:function(r){return null==r?"":""==r?null:e._decompress(r.length,32,function(t){return o(n,r.charAt(t))})},_compress:function(o,n,t){if(null==o)return"";var e,i,s,p={},u={},c="",a="",l="",f=2,h=3,d=2,m=[],v=0,g=0;for(i=0;i<o.length;i+=1)if(c=o.charAt(i),Object.prototype.hasOwnProperty.call(p,c)||(p[c]=h++,u[c]=!0),a=l+c,Object.prototype.hasOwnProperty.call(p,a))l=a;else{if(Object.prototype.hasOwnProperty.call(u,l)){if(l.charCodeAt(0)<256){for(e=0;e<d;e++)v<<=1,g==n-1?(g=0,m.push(t(v)),v=0):g++;for(s=l.charCodeAt(0),e=0;e<8;e++)v=v<<1|1&s,g==n-1?(g=0,m.push(t(v)),v=0):g++,s>>=1}else{for(s=1,e=0;e<d;e++)v=v<<1|s,g==n-1?(g=0,m.push(t(v)),v=0):g++,s=0;for(s=l.charCodeAt(0),e=0;e<16;e++)v=v<<1|1&s,g==n-1?(g=0,m.push(t(v)),v=0):g++,s>>=1}f--,0==f&&(f=Math.pow(2,d),d++),delete u[l]}else for(s=p[l],e=0;e<d;e++)v=v<<1|1&s,g==n-1?(g=0,m.push(t(v)),v=0):g++,s>>=1;f--,0==f&&(f=Math.pow(2,d),d++),p[a]=h++,l=String(c)}if(""!==l){if(Object.prototype.hasOwnProperty.call(u,l)){if(l.charCodeAt(0)<256){for(e=0;e<d;e++)v<<=1,g==n-1?(g=0,m.push(t(v)),v=0):g++;for(s=l.charCodeAt(0),e=0;e<8;e++)v=v<<1|1&s,g==n-1?(g=0,m.push(t(v)),v=0):g++,s>>=1}else{for(s=1,e=0;e<d;e++)v=v<<1|s,g==n-1?(g=0,m.push(t(v)),v=0):g++,s=0;for(s=l.charCodeAt(0),e=0;e<16;e++)v=v<<1|1&s,g==n-1?(g=0,m.push(t(v)),v=0):g++,s>>=1}f--,0==f&&(f=Math.pow(2,d),d++),delete u[l]}else for(s=p[l],e=0;e<d;e++)v=v<<1|1&s,g==n-1?(g=0,m.push(t(v)),v=0):g++,s>>=1;f--,0==f&&(f=Math.pow(2,d),d++)}for(s=2,e=0;e<d;e++)v=v<<1|s,g==n-1?(g=0,m.push(t(v)),v=0):g++,s=0;for(;;){if(v<<=1,g==n-1){m.push(t(v));break}g++}return m.join("")},_decompress:function(o,n,t){var e,i,s,p,u,c,a,l,f=[],h=4,d=4,m=3,v="",g=[],w={val:t(0),position:n,index:1};for(i=0;i<3;i+=1)f[i]=i;for(s=0,u=Math.pow(2,2),c=1;c!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=t(w.index++)),s|=(p>0?1:0)*c,c<<=1;switch(e=s){case 0:for(s=0,u=Math.pow(2,8),c=1;c!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=t(w.index++)),s|=(p>0?1:0)*c,c<<=1;a=r(s);break;case 1:for(s=0,u=Math.pow(2,16),c=1;c!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=t(w.index++)),s|=(p>0?1:0)*c,c<<=1;a=r(s);break;case 2:return""}for(f[3]=a,l=a,g.push(a);;){if(w.index>o)return"";for(s=0,u=Math.pow(2,m),c=1;c!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=t(w.index++)),s|=(p>0?1:0)*c,c<<=1;switch(a=s){case 0:for(s=0,u=Math.pow(2,8),c=1;c!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=t(w.index++)),s|=(p>0?1:0)*c,c<<=1;f[d++]=r(s),a=d-1,h--;break;case 1:for(s=0,u=Math.pow(2,16),c=1;c!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=t(w.index++)),s|=(p>0?1:0)*c,c<<=1;f[d++]=r(s),a=d-1,h--;break;case 2:return g.join("")}if(0==h&&(h=Math.pow(2,m),m++),f[a])v=f[a];else{if(a!==d)return null;v=l+l.charAt(0)}g.push(v),f[d++]=l+v.charAt(0),h--,l=v,0==h&&(h=Math.pow(2,m),m++)}}
};return e}();
</script>

<script>
const el = id => document.getElementById(id);
const formIds = ["img","name","univ","major","grade","phone","email","interests","linkedin"];

function packData() {
  const data = {
    // short keys to keep payload tiny
    i: el("img").value.trim(),
    n: el("name").value.trim(),
    u: el("univ").value.trim(),
    m: el("major").value.trim(),
    g: el("grade").value.trim(),
    p: el("phone").value.trim(),
    e: el("email").value.trim(),
    s: el("interests").value.trim(),
    l: el("linkedin").value.trim()
  };
  // minimal sanity
  if (!data.n) { alert("Please enter your full name."); return null; }
  if (data.l && !/^https?:\/\//i.test(data.l)) data.l = "https://" + data.l;
  if (data.i && !/^https?:\/\//i.test(data.i)) data.i = "https://" + data.i;
  return data;
}

function generateUrl() {
  const data = packData();
  if (!data) return;

  const json = JSON.stringify(data);
  const compressed = LZString.compressToEncodedURIComponent(json);
  const base = location.origin + location.pathname.replace(/index\.html?$/i,'');
  const url = base + "#" + compressed;

  el("urlOut").value = url;
  updateLen(url);

  if (url.length > 482) {
    alert("The generated URL is " + url.length + " characters, which exceeds the 482 character limit.\n\nTips:\n• Shorten Interests (use 3–5 keywords)\n• Abbreviate University/Major\n• Remove optional fields like photo/LinkedIn\nThen try again.");
  }
}

function updateLen(urlStr) {
  const L = (urlStr || el("urlOut").value || "").length;
  const span = el("len");
  span.textContent = L;
  span.className = "len " + (L>0 && L <= 482 ? "ok" : (L>482 ? "bad" : ""));
}

function clearForm() {
  formIds.forEach(id => { if (el(id)) el(id).value = ""; });
  el("urlOut").value = "";
  updateLen("");
}

function copyUrl() {
  const v = el("urlOut").value;
  if (!v) return;
  navigator.clipboard.writeText(v).then(()=> {
    const b = el("copyBtn");
    const orig = b.textContent;
    b.textContent = "Copied!";
    setTimeout(()=> b.textContent = orig, 1200);
  });
}

function viewModeFromHash() {
  if (!location.hash || location.hash.length < 2) return false;
  try {
    const compressed = location.hash.slice(1);
    const json = LZString.decompressFromEncodedURIComponent(compressed);
    if (!json) return false;
    const d = JSON.parse(json);

    // populate viewer
    const safe = txt => (txt||"").toString();
    if (d.i) { el("v_img").src = d.i; el("v_img").style.display='block'; } else { el("v_img").style.display='none'; }
    el("v_name").textContent = safe(d.n);
    el("v_grade").textContent = safe(d.g || "");
    el("v_grade").style.display = d.g ? "inline-block" : "none";

    el("v_univ").textContent = safe(d.u);
    el("v_major").textContent = safe(d.m);

    // phone + email as links if present
    const phone = safe(d.p);
    el("v_phone").innerHTML = phone ? `<a href="tel:${phone.replace(/[^\d+]/g,'')}">${phone}</a>` : "";

    const email = safe(d.e);
    el("v_email").innerHTML = email ? `<a href="mailto:${email}">${email}</a>` : "";

    // LinkedIn link (display compact)
    const li = safe(d.l);
    if (li) {
      const shown = li.replace(/^https?:\/\//i,'').replace(/\/$/,'');
      el("v_linkedin").innerHTML = `<a href="${li}" rel="noopener noreferrer" target="_blank">${shown}</a>`;
    } else {
      el("v_linkedin").textContent = "";
    }

    // interests as pills
    const wrap = el("v_interests");
    wrap.innerHTML = "";
    const list = safe(d.s).split(/[,;]\s*|\n+/).map(x=>x.trim()).filter(Boolean).slice(0,24);
    list.forEach(tag => {
      const span = document.createElement("span");
      span.className = "pill";
      span.textContent = tag;
      wrap.appendChild(span);
    });
    el("v_interests_wrap").style.display = list.length ? "block" : "none";

    // toggle panels
    el("generator").classList.add("hidden");
    el("viewer").classList.remove("hidden");
    document.title = (d.n ? d.n + " — " : "") + "Contact Card";
    return true;
  } catch(e) {
    console.error(e);
    return false;
  }
}

// Wire up
el("generateBtn").addEventListener("click", generateUrl);
el("copyBtn").addEventListener("click", copyUrl);
el("clearBtn").addEventListener("click", clearForm);
el("urlOut").addEventListener("input", ()=>updateLen());
window.addEventListener("hashchange", ()=>{ if (!viewModeFromHash()) location.reload(); });

// If opened with a hash, switch to view mode immediately
viewModeFromHash();
</script>
</body>
</html>

