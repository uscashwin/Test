<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Smart Contact Card</title>
<style>
  :root{
    --bg:#0a1040;
    --card:#0f47ff;
    --card2:#3b82f6;
    --muted:#9db3ff;
    --text:#eef2ff;
    --white:#ffffff;
    --chip:#1a2a80;
    --shadow: 0 20px 50px rgba(0,0,0,.35);
    --radius:24px;
  }
  html,body{height:100%}
  body{
    margin:0;background:radial-gradient(1200px 800px at 90% -10%, #1430a5 0%, var(--bg) 55%);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    color:var(--text); display:flex; align-items:center; justify-content:center; padding:18px;
  }
  .wrap{width:100%; max-width:420px}
  .phone{
    background:#0b0f2f; border-radius:36px; padding:14px; box-shadow: var(--shadow); position:relative;
    border:1px solid rgba(255,255,255,.06)
  }
  .screen{background:linear-gradient(180deg, #1b2ccf 0%, #2563eb 40%, #1d4ed8 100%);
    border-radius:28px; overflow:hidden; min-height:680px; position:relative}
  .hero{
    position:relative; height:240px; background:
      linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(13,25,92,.55) 60%, rgba(13,25,92,.85) 100%);
    display:flex; align-items:flex-end; justify-content:center; padding-bottom:16px
  }
  .avatar{
    position:absolute; left:50%; top:24px; transform:translateX(-50%);
    width:160px; height:160px; border-radius:24px; overflow:hidden;
    box-shadow:0 16px 40px rgba(0,0,0,.35), inset 0 0 0 2px rgba(255,255,255,.5)
  }
  .avatar img{width:100%; height:100%; object-fit:cover}
  h1{margin:0; font-size:26px; line-height:1.1; text-align:center; color:#fff; text-shadow:0 2px 10px rgba(0,0,0,.35)}
  .sub{margin-top:6px; text-align:center; color:var(--muted); font-weight:500}
  .actions{display:flex; gap:12px; justify-content:center; margin:16px 0 4px}
  .iconbtn{
    width:46px; height:46px; border-radius:999px; background:rgba(255,255,255,.2);
    display:grid; place-items:center; border:1px solid rgba(255,255,255,.35); backdrop-filter: blur(6px);
    cursor:pointer; text-decoration:none; color:#fff
  }
  .section{
    background:rgba(255,255,255,.16); border:1px solid rgba(255,255,255,.28);
    border-radius:18px; margin:14px; padding:16px
  }
  .section h3{margin:0 0 8px; font-size:15px; letter-spacing:.3px; color:#eef2ff}
  .about{color:#e6edff; opacity:.95; font-size:14px}
  .grid{display:grid; gap:10px}
  .row{display:flex; gap:8px; align-items:center; color:#eaf0ff; font-size:14px}
  .chip{background:var(--chip); border:1px solid rgba(255,255,255,.18); padding:8px 12px;
        border-radius:999px; font-size:12px; color:#cfe0ff}
  .footerbar{
    position:sticky; bottom:0; display:flex; gap:10px; justify-content:center; padding:12px;
  }
  .btn{
    background:#0ea5e9; border:none; color:#fff; padding:12px 14px; border-radius:14px;
    font-weight:600; cursor:pointer; box-shadow:0 10px 25px rgba(14,165,233,.35)
  }
  .btn.secondary{background:#22c55e; box-shadow:0 10px 25px rgba(34,197,94,.35)}
  .btn.ghost{background:transparent; border:1px solid rgba(255,255,255,.35)}
  /* form */
  form{padding:16px 14px 6px}
  label{font-size:12px; color:#dbe7ff; letter-spacing:.3px}
  input, textarea{
    width:100%; margin:6px 0 12px; border-radius:12px; border:1px solid rgba(255,255,255,.3);
    background:rgba(8,16,64,.3); color:#fff; padding:12px 12px; outline:none
  }
  input::placeholder, textarea::placeholder{color:#c5d3ff99}
  textarea{min-height:82px; resize:vertical}
  .inline{display:grid; grid-template-columns: 1fr 1fr; gap:10px}
  .hide{display:none !important}
  .copy{
    display:flex; gap:8px; align-items:center; justify-content:center; color:#bbd1ff; font-size:12px; margin: 6px 0 12px
  }
  .urlbox{
    overflow:auto; white-space:nowrap; background:rgba(255,255,255,.08); padding:8px 10px; border-radius:10px; border:1px solid rgba(255,255,255,.18)
  }
  small.muted{color:#b9c7ff; opacity:.8; font-size:12px}
  a.link{color:#fff; text-decoration:underline; text-underline-offset:2px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="phone">
      <div class="screen" id="screen">

        <!-- READ-ONLY CARD -->
        <div id="card" class="hide">
          <div class="hero">
            <div class="avatar"><img id="c_img" alt="Profile picture" /></div>
            <div style="margin-top:170px;width:100%;padding:0 16px;">
              <h1 id="c_name">â€”</h1>
              <div class="sub" id="c_title">â€”</div>
              <div class="actions" id="quick">
                <!-- icons rendered by JS -->
              </div>
            </div>
          </div>

          <div class="section">
            <h3>About Me</h3>
            <div class="about" id="c_about">â€”</div>
          </div>

          <div class="section">
            <h3>Details</h3>
            <div class="grid">
              <div class="row">ðŸŽ“ <span id="c_univ">â€”</span></div>
              <div class="row">ðŸ“˜ <span id="c_major">â€”</span></div>
              <div class="row">ðŸ“… <span id="c_grade">â€”</span></div>
              <div class="row">ðŸ”— <a class="link" target="_blank" id="c_link">LinkedIn</a></div>
              <div class="row">ðŸ“§ <a class="link" id="c_email"></a></div>
              <div class="row">ðŸ“ž <a class="link" id="c_phone"></a></div>
            </div>
          </div>

          <div class="section">
            <h3>Interests</h3>
            <div id="c_interests" class="grid"></div>
          </div>

          <div class="footerbar">
            <button class="btn secondary" id="dlVcf">Add to Contacts</button>
            <a class="btn ghost" id="shareBtn" target="_blank">Open Share Link</a>
          </div>
        </div>

        <!-- CREATE / EDIT FORM (only shown when no ?v= param) -->
        <div id="formwrap">
          <div class="hero" style="height:180px; align-items:center; justify-content:center">
            <h1>Create Your Contact Card</h1>
          </div>

          <form id="cardForm" autocomplete="on">
            <label>Profile Picture URL (Google Drive share link OK)</label>
            <input id="f_img" type="url" placeholder="https://drive.google.com/file/d/FILE_ID/view?usp=sharing" />

            <div class="inline">
              <div>
                <label>Full Name</label>
                <input id="f_name" placeholder="Your name" />
              </div>
              <div>
                <label>Grade Level</label>
                <input id="f_grade" placeholder="Senior, MS, etc." />
              </div>
            </div>

            <label>University</label>
            <input id="f_univ" placeholder="University / School" />

            <label>Major</label>
            <input id="f_major" placeholder="e.g., Mechanical Engineering" />

            <label>Short Bio (1â€“2 sentences)</label>
            <textarea id="f_about" placeholder="Tell people who you are and what you do."></textarea>

            <div class="inline">
              <div>
                <label>LinkedIn URL</label>
                <input id="f_link" type="url" placeholder="https://www.linkedin.com/in/username" />
              </div>
              <div>
                <label>Phone Number</label>
                <input id="f_phone" type="tel" placeholder="+1 555 123 4567" />
              </div>
            </div>

            <label>Email</label>
            <input id="f_email" type="email" placeholder="you@example.com" />

            <label>Interests (comma-separated)</label>
            <input id="f_interests" placeholder="rocketry, product design, startups" />

            <div class="footerbar" style="margin-top:8px">
              <button type="button" class="btn" id="gen">Generate share link</button>
              <button type="button" class="btn secondary" id="preview">Preview card</button>
            </div>

            <div id="linkBlock" class="copy hide">
              <div class="urlbox" id="shareUrl">â€”</div>
              <button type="button" class="btn ghost" id="copy">Copy</button>
            </div>
            <p class="copy"><small class="muted">
              This page is offline-ready and serverless. The generated link encodes your data;
              anyone opening the link sees a read-only cardâ€”no editing possible.
            </small></p>
          </form>
        </div>

      </div>
    </div>
  </div>

<script>
  // --- helpers -------------------------------------------------
  const qs = (s, o=document)=>o.querySelector(s);
  const qsa = (s, o=document)=>[...o.querySelectorAll(s)];

  // Base64 (UTF-8 safe)
  function encode64(obj){
    const json = JSON.stringify(obj);
    return btoa(unescape(encodeURIComponent(json)));
  }
  function decode64(s){
    return JSON.parse(decodeURIComponent(escape(atob(s))));
  }

  // Convert common Google Drive share links to direct image links
  function driveToDirect(url){
    if(!url) return "";
    try{
      const u = new URL(url);
      if(u.hostname.includes("drive.google.com")){
        // patterns: /file/d/<id>/view, or /uc?id=<id>, or open?id=<id>
        let id = u.pathname.split("/").includes("file") ? u.pathname.split("/")[3] : (u.searchParams.get("id") || "");
        if(id) return `https://drive.google.com/uc?export=view&id=${id}`;
      }
    }catch(e){}
    return url;
  }

  // Build short object with tiny keys to keep URL compact
  function collectForm(){
    return {
      N: qs("#f_name").value.trim(),
      U: qs("#f_univ").value.trim(),
      M: qs("#f_major").value.trim(),
      G: qs("#f_grade").value.trim(),
      A: qs("#f_about").value.trim(),
      I: qs("#f_interests").value.trim(),
      L: qs("#f_link").value.trim(),
      P: qs("#f_phone").value.trim(),
      E: qs("#f_email").value.trim(),
      IMG: driveToDirect(qs("#f_img").value.trim())
    };
  }

  function fillCard(d){
    const img = d.IMG || "";
    qs("#c_img").src = img || "https://picsum.photos/seed/initials/600/600";
    qs("#c_name").textContent = d.N || "Your Name";
    qs("#c_title").textContent = (d.G? d.G+" Â· " : "") + (d.M || "");
    qs("#c_about").textContent = d.A || "â€”";
    qs("#c_univ").textContent = d.U || "â€”";
    qs("#c_major").textContent = d.M || "â€”";
    qs("#c_grade").textContent = d.G || "â€”";

    // Interests chips
    const wrap = qs("#c_interests");
    wrap.innerHTML = "";
    (d.I||"").split(",").map(s=>s.trim()).filter(Boolean).slice(0,16).forEach(s=>{
      const chip = document.createElement("span");
      chip.className = "chip"; chip.textContent = s; wrap.appendChild(chip);
    });

    // links
    const link = d.L && d.L.startsWith("http") ? d.L : "";
    const mail = d.E ? `mailto:${d.E}` : "#";
    const tel  = d.P ? `tel:${d.P.replace(/[^\d+]/g,"")}` : "#";
    qs("#c_link").href = link || "#";
    qs("#c_link").textContent = link ? "LinkedIn Profile" : "â€”";
    qs("#c_email").href = mail; qs("#c_email").textContent = d.E || "â€”";
    qs("#c_phone").href = tel;  qs("#c_phone").textContent = d.P || "â€”";

    // quick round buttons
    const quick = qs("#quick"); quick.innerHTML = "";
    const mk = (href, label, glyph) => {
      if(!href || href==="#") return;
      const a = document.createElement("a");
      a.href = href; a.className = "iconbtn"; a.setAttribute("aria-label", label);
      a.innerHTML = glyph; quick.appendChild(a);
    };
    const iconMail = '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16v16H4z"/><path d="M22 6l-10 7L2 6"/></svg>';
    const iconPhone= '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07A19.5 19.5 0 0 1 3.15 8.81 19.79 19.79 0 0 1 .08 0c0-1.2.8-2.17 2-2.17h3a2 2 0 0 1 2 1.72c.12.89.31 1.76.57 2.6a2 2 0 0 1-.45 2.11L6.1 6.72a16 16 0 0 0 7.18 7.18l2.46-1.11a2 2 0 0 1 2.11.45c.84.26 1.71.45 2.6.57A2 2 0 0 1 22 16.92z"/></svg>';
    const iconLI   = '<svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1 4.98 2.12 4.98 3.5zM.5 8.5h4V24h-4V8.5zM8.5 8.5h3.8v2.1h.1c.5-.9 1.7-2.1 3.6-2.1 3.9 0 4.6 2.6 4.6 6V24h-4v-6.6c0-1.6 0-3.7-2.2-3.7s-2.6 1.7-2.6 3.5V24h-4V8.5z"/></svg>';
    mk(mail, "Email", iconMail);
    mk(tel, "Phone", iconPhone);
    if(link) mk(link, "LinkedIn", iconLI);
  }

  function buildURL(d){
    const packed = encode64(d);
    return location.origin + location.pathname + "?v=" + packed;
  }

  function showView(d){
    fillCard(d);
    qs("#formwrap").classList.add("hide");
    qs("#card").classList.remove("hide");
    const url = buildURL(d);
    qs("#shareBtn").href = url;
    // vCard download
    qs("#dlVcf").onclick = () => downloadVcf(d);
  }

  function downloadVcf(d){
    const lines = [
      "BEGIN:VCARD",
      "VERSION:3.0",
      `FN:${d.N||""}`,
      `ORG:${d.U||""}`,
      `TITLE:${(d.G||"") + (d.M? (d.G?" Â· ":"") + d.M : "")}`,
      d.P ? `TEL;TYPE=CELL,VOICE:${d.P}` : "",
      d.E ? `EMAIL;TYPE=INTERNET:${d.E}` : "",
      d.L ? `URL:${d.L}` : "",
      d.IMG ? `PHOTO;VALUE=URI:${d.IMG}` : "",
      "END:VCARD"
    ].filter(Boolean).join("\n");
    const blob = new Blob([lines], {type:"text/vcard"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = (d.N?.replace(/\s+/g,"_") || "contact") + ".vcf";
    a.click();
    setTimeout(()=>URL.revokeObjectURL(a.href), 2000);
  }

  // --- wiring --------------------------------------------------
  (function init(){
    const params = new URLSearchParams(location.search);
    const v = params.get("v");
    if(v){
      try { showView(decode64(v)); }
      catch(e){ alert("Invalid link data."); }
      return;
    }

    // Create mode
    qs("#gen").onclick = ()=>{
      const d = collectForm();
      const url = buildURL(d);
      qs("#linkBlock").classList.remove("hide");
      qs("#shareUrl").textContent = url;
    };
    qs("#copy").onclick = async ()=>{
      const txt = qs("#shareUrl").textContent.trim();
      if(!txt) return;
      try{ await navigator.clipboard.writeText(txt); alert("Link copied!"); }
      catch(e){ /* fallback */ }
    };
    qs("#preview").onclick = ()=>{
      const d = collectForm();
      // open preview in same tab
      location.href = buildURL(d);
    };
  })();
</script>
</body>
</html>

