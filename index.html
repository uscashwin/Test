<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NFC Contact Link • Generator & Viewer</title>
  <meta name="description" content="Create a compact NFC URL that renders a view-only contact card." />
  <style>
    :root{
      --bg: #0b0f14; --card:#121821; --muted:#7b8794; --text:#e6edf3; --accent:#4cc9f0; --ok:#22c55e; --warn:#f59e0b; --err:#ef4444; --border:#263041;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; background:linear-gradient(180deg,#0b0f14,#0a0d11); color:var(--text); min-height:100dvh; display:flex; align-items:center; justify-content:center; padding:24px}
    .wrap{width:100%; max-width:980px}
    .card{background:linear-gradient(180deg,#121821,#0f141c); border:1px solid var(--border); border-radius:20px; padding:24px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h1{margin:0 0 8px; font-size:1.6rem; letter-spacing:.3px}
    p.sub{margin:0 0 20px; color:var(--muted)}
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:16px}
    .grid-1{grid-template-columns:1fr}
    label{display:block; font-size:.9rem; color:#b7c2cc; margin:8px 0 6px}
    input, textarea{width:100%; border:1px solid var(--border); background:#0c1117; color:var(--text); padding:12px 14px; border-radius:12px; outline:none}
    input:focus, textarea:focus{border-color:#334155; box-shadow:0 0 0 3px rgba(76,201,240,.15)}
    .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    button{background:var(--accent); color:#05141f; border:0; padding:12px 16px; border-radius:12px; font-weight:700; cursor:pointer}
    button.secondary{background:#17202b; color:#cfe8ff; border:1px solid var(--border)}
    .out{margin-top:16px; padding:12px; border:1px dashed var(--border); border-radius:12px; word-break:break-all; background:#0a0f15}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; background:#0f1722; border:1px solid var(--border); color:#bcd0e0; font-size:.85rem}
    .pill.ok{border-color:#1f5130; color:#86efac; background:#0e1a12}
    .pill.warn{border-color:#5b440f; color:#facc15; background:#161206}
    .pill.err{border-color:#5b1b1b; color:#fca5a5; background:#170b0b}
    .split{display:grid; grid-template-columns: 260px 1fr; gap:20px}
    .viewer{display:flex; gap:16px; align-items:stretch}
    .avatar{width:220px; min-width:220px; aspect-ratio:1/1; border-radius:16px; background:#0a0f15 center/cover no-repeat; border:1px solid var(--border)}
    .vcard{padding:4px}
    .vrow{display:flex; align-items:center; gap:10px; margin:8px 0; color:#d7e0ea}
    .k{width:110px; color:#9fb0c1}
    a{color:#7dd3fc; text-decoration:none}
    a:hover{text-decoration:underline}
    .footer{margin-top:16px; color:#9fb0c1}
    .hide{display:none !important}
    .small{font-size:.9rem}
    @media (max-width:900px){ .split{grid-template-columns:1fr} .viewer{flex-direction:column} .avatar{width:100%; min-width:unset} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div id="generator">
        <h1>NFC Contact URL Generator</h1>
        <p class="sub">Enter your details. We’ll produce a compact, URL-safe link (&lt; 482 chars) that opens a <strong>view-only</strong> contact card.</p>

        <div class="grid">
          <div>
            <label for="u">Profile Image URL (optional)</label>
            <input id="u" placeholder="https://... (use a short image URL)" />
          </div>
          <div>
            <label for="n">Full Name</label>
            <input id="n" placeholder="Ada Lovelace" />
          </div>
          <div>
            <label for="ph">Phone</label>
            <input id="ph" placeholder="+1 555 867 5309" />
          </div>
          <div>
            <label for="em">Email</label>
            <input id="em" placeholder="ada@example.com" />
          </div>
          <div class="grid-1">
            <label for="li">LinkedIn</label>
            <input id="li" placeholder="linkedin.com/in/your-handle (short is best)" />
          </div>
          <div class="grid-1">
            <label for="in">Interests (comma-separated, optional)</label>
            <input id="in" placeholder="Propulsion, Avionics, CFD" />
          </div>
        </div>

        <div class="row" style="margin-top:16px">
          <button id="gen">Generate URL</button>
          <button id="clear" class="secondary">Clear</button>
          <span id="lenpill" class="pill">Length: <strong id="urllen">0</strong> chars</span>
        </div>

        <div id="out" class="out hide"></div>

        <div class="row" style="margin-top:10px">
          <button id="copy" class="secondary hide">Copy URL</button>
          <button id="open" class="secondary hide">Open Preview</button>
        </div>

        <p class="footer small">Tip: To keep the URL under 482 characters, prefer a short LinkedIn handle and a concise Interests list.</p>
      </div>

      <div id="viewer" class="hide">
        <h1>Contact Card</h1>
        <p class="sub">View-only</p>
        <div class="split">
          <div class="avatar" id="av"></div>
          <div class="vcard" id="vc">
            <!-- Filled by JS -->
          </div>
        </div>
        <div class="row" style="margin-top:16px">
          <a id="backlink" class="pill" href="./">← Create your own</a>
        </div>
      </div>
    </div>
  </div>

  <!-- LZ-String (minimal build: compressToEncodedURIComponent / decompressFromEncodedURIComponent) -->
  <script>
  /* LZ-String 1.4.4 (URL-encoded only) – https://github.com/pieroxy/lz-string – MIT
     Trimmed to only the two functions we use to keep things light. */
  var LZString=function(){function o(o,r){if(!t[o]){t[o]={};for(var n=0;n<o.length;n++)t[o][o.charAt(n)]=n}return t[o][r]}var r=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",t={},e={compressToEncodedURIComponent:function(o){return null==o?"":e._compress(o,6,function(o){return n.charAt(o)})},decompressFromEncodedURIComponent:function(r){return null==r?"":""==r?null:e._decompress(r.length,32,function(t){return o(n,r.charAt(t))})},_compress:function(o,n,t){if(null==o)return"";var e,i,u,s={},a={},c="",p="",l="",f=2,h=3,d=2,v=[],g=0,m=0;for(i=0;i<o.length;i+=1)if(c=o.charAt(i),Object.prototype.hasOwnProperty.call(s,c)||(s[c]=h++,a[c]=!0),p=l+c,Object.prototype.hasOwnProperty.call(s,p))l=p;else{if(Object.prototype.hasOwnProperty.call(a,l)){if(l.charCodeAt(0)<256){for(e=0;e<d;e++)g<<=1,m==n-1?(m=0,v.push(t(g)),g=0):m++;for(u=l.charCodeAt(0),e=0;e<8;e++)g=g<<1|1&u,m==n-1?(m=0,v.push(t(g)),g=0):m++,u>>=1}else{for(u=1,e=0;e<d;e++)g=g<<1|u,m==n-1?(m=0,v.push(t(g)),g=0):m++,u=0;for(u=l.charCodeAt(0),e=0;e<16;e++)g=g<<1|1&u,m==n-1?(m=0,v.push(t(g)),g=0):m++,u>>=1}f--,0==f&&(f=Math.pow(2,d),d++),delete a[l]}else for(u=s[l],e=0;e<d;e++)g=g<<1|1&u,m==n-1?(m=0,v.push(t(g)),g=0):m++,u>>=1;f--,0==f&&(f=Math.pow(2,d),d++),s[p]=h++,l=String(c)}if(""!==l){if(Object.prototype.hasOwnProperty.call(a,l)){if(l.charCodeAt(0)<256){for(e=0;e<d;e++)g<<=1,m==n-1?(m=0,v.push(t(g)),g=0):m++;for(u=l.charCodeAt(0),e=0;e<8;e++)g=g<<1|1&u,m==n-1?(m=0,v.push(t(g)),g=0):m++,u>>=1}else{for(u=1,e=0;e<d;e++)g=g<<1|u,m==n-1?(m=0,v.push(t(g)),g=0):m++,u=0;for(u=l.charCodeAt(0),e=0;e<16;e++)g=g<<1|1&u,m==n-1?(m=0,v.push(t(g)),g=0):m++,u>>=1}f--,0==f&&(f=Math.pow(2,d),d++),delete a[l]}else for(u=s[l],e=0;e<d;e++)g=g<<1|1&u,m==n-1?(m=0,v.push(t(g)),g=0):m++,u>>=1;f--,0==f&&(f=Math.pow(2,d),d++)}for(u=2,e=0;e<d;e++)g=g<<1|1&u,m==n-1?(m=0,v.push(t(g)),g=0):m++,u>>=1;for(;;){if(g<<=1,m==n-1){v.push(t(g));break}m++}return v.join("")},_decompress:function(o,n,t){var e,i,u,s,a,c,p,l,f,h=[],d=4,v=4,g=3,m="",w=[],C={val:t(0),position:n,index:1};for(i=0;i<3;i+=1)h[i]=i;for(a=0,c=Math.pow(2,2),p=1;p!=c;)s=C.val&C.position,C.position>>=1,0==C.position&&(C.position=n,C.val=t(C.index++)),a|=(s>0?1:0)*p,p<<=1;switch(a){case 0:for(a=0,c=Math.pow(2,8),p=1;p!=c;)s=C.val&C.position,C.position>>=1,0==C.position&&(C.position=n,C.val=t(C.index++)),a|=(s>0?1:0)*p,p<<=1;f=r(a);break;case 1:for(a=0,c=Math.pow(2,16),p=1;p!=c;)s=C.val&C.position,C.position>>=1,0==C.position&&(C.position=n,C.val=t(C.index++)),a|=(s>0?1:0)*p,p<<=1;f=r(a);break;case 2:return""}for(h[3]=f,l=f,w.push(f);;){if(C.index>o)return"";for(a=0,c=Math.pow(2,g),p=1;p!=c;)s=C.val&C.position,C.position>>=1,0==C.position&&(C.position=n,C.val=t(C.index++)),a|=(s>0?1:0)*p,p<<=1;switch(u=a){case 0:for(a=0,c=Math.pow(2,8),p=1;p!=c;)s=C.val&C.position,C.position>>=1,0==C.position&&(C.position=n,C.val=t(C.index++)),a|=(s>0?1:0)*p,p<<=1;h[v++]=r(a),u=d-1,g=2;break;case 1:for(a=0,c=Math.pow(2,16),p=1;p!=c;)s=C.val&C.position,C.position>>=1,0==C.position&&(C.position=n,C.val=t(C.index++)),a|=(s>0?1:0)*p,p<<=1;h[v++]=r(a),u=d-1,g=2;break;case 2:return w.join("")}if(d=u+1, h[u])m=h[u];else{if(u!==v)return null;m=l+l.charAt(0)}w.push(m),h[v++]=l+m.charAt(0),l=m,0==--g&&(g=Math.pow(2,++e))}}
  }();
  </script>

  <script>
    // Short keys to reduce payload size:
    // u = image URL, n = name, ph = phone, em = email, in = interests, li = LinkedIn
    const $ = sel => document.querySelector(sel);
    const qs = new URLSearchParams(location.search);
    const MAX_URL = 482;

    function sanitize(v){ return (v||"").trim(); }
    function compactPayload(data){
      // Remove empties, keep order stable
      const o = {};
      if (data.u) o.u = data.u;
      if (data.n) o.n = data.n;
      if (data.ph) o.ph = data.ph;
      if (data.em) o.em = data.em;
      if (data.in) o.in = data.in;
      if (data.li) o.li = data.li;
      return o;
    }
    function encodeData(o){
      const json = JSON.stringify(o);
      return LZString.compressToEncodedURIComponent(json);
    }
    function decodeData(s){
      const json = LZString.decompressFromEncodedURIComponent(s);
      return JSON.parse(json);
    }
    function buildURL(enc){
      // Use relative path to keep it short; when copied it’ll be absolute.
      const base = location.origin + location.pathname;
      return `${base}?d=${enc}`;
    }
    function setLenPill(len){
      const pill = $('#lenpill');
      const el = $('#urllen');
      el.textContent = len;
      pill.classList.remove('ok','warn','err');
      if (len === 0) return;
      if (len <= MAX_URL) pill.classList.add('ok');
      else if (len <= MAX_URL + 60) pill.classList.add('warn');
      else pill.classList.add('err');
    }
    function validateBasic(){
      const em = sanitize($('#em').value);
      const li = sanitize($('#li').value);
      const u  = sanitize($('#u').value);
      if (em && !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(em)) return {ok:false,msg:'Invalid email format.'};
      if (li && !/^https?:\/\/|^([a-z0-9.-]+\.[a-z]{2,})|^linkedin\.com\//i.test(li)) return {ok:false,msg:'LinkedIn should be a URL or handle.'};
      if (u && !/^https?:\/\//i.test(u)) return {ok:false,msg:'Profile image must be a URL starting with http(s)://'};
      return {ok:true};
    }
    function renderViewer(data){
      const v = $('#viewer'), g = $('#generator');
      g.classList.add('hide'); v.classList.remove('hide');
      const av = $('#av');
      if (data.u) av.style.backgroundImage = `url("${data.u}")`;
      else av.style.backgroundImage = 'linear-gradient(135deg,#0d1320,#0a0f15)';
      const vc = $('#vc');
      vc.innerHTML = '';
      function row(label, value, isLink){
        if (!value) return;
        const div = document.createElement('div');
        div.className = 'vrow';
        const k = document.createElement('div');
        k.className='k'; k.textContent = label;
        const v = document.createElement('div');
        if (isLink){
          const a = document.createElement('a');
          a.href = value.startsWith('http') ? value : ('https://' + value.replace(/^\/\//,''));
          a.target = '_blank'; a.rel='noopener';
          a.textContent = value;
          v.appendChild(a);
        } else {
          v.textContent = value;
        }
        div.appendChild(k); div.appendChild(v);
        vc.appendChild(div);
      }
      row('Full Name', data.n);
      row('Phone', data.ph);
      row('Email', data.em ? data.em : '');
      if (data.em){
        // Make email link
        const last = vc.lastElementChild?.lastElementChild;
        if (last) { last.innerHTML = `<a href="mailto:${data.em}">${data.em}</a>`; }
      }
      row('Interests', data.in);
      row('LinkedIn', data.li, true);
    }
    function renderGenerator(){
      $('#viewer').classList.add('hide');
      $('#generator').classList.remove('hide');
    }

    // Mode switch on load
    (function init(){
      const d = qs.get('d');
      if (d){
        try {
          const data = decodeData(d);
          renderViewer(data);
          return;
        } catch(e){
          // If decoding fails, fall back to generator with an error hint
          renderGenerator();
          const out = $('#out');
          out.classList.remove('hide');
          out.innerHTML = `<span class="pill err">Could not read contact data from URL.</span>`;
        }
      } else {
        renderGenerator();
      }
    })();

    // Live length indicator as fields change
    ['u','n','ph','em','in','li'].forEach(id=>{
      const el = document.getElementById(id);
      el?.addEventListener('input', ()=>{
        const chk = validateBasic();
        const data = compactPayload({
          u:sanitize($('#u').value),
          n:sanitize($('#n').value),
          ph:sanitize($('#ph').value),
          em:sanitize($('#em').value),
          in:sanitize($('#in').value),
          li:sanitize($('#li').value),
        });
        try {
          const enc = encodeData(data);
          const url = buildURL(enc);
          setLenPill(url.length);
        } catch {
          setLenPill(0);
        }
      });
    });

    // Generate
    $('#gen').addEventListener('click', ()=>{
      const val = validateBasic();
      const out = $('#out'); const copyBtn = $('#copy'); const openBtn = $('#open');
      if (!val.ok){
        out.classList.remove('hide');
        out.innerHTML = `<span class="pill err">${val.msg}</span>`;
        copyBtn.classList.add('hide'); openBtn.classList.add('hide');
        return;
      }
      const data = compactPayload({
        u:sanitize($('#u').value),
        n:sanitize($('#n').value),
        ph:sanitize($('#ph').value),
        em:sanitize($('#em').value),
        in:sanitize($('#in').value),
        li:sanitize($('#li').value),
      });
      const enc = encodeData(data);
      const url = buildURL(enc);
      setLenPill(url.length);
      let status = '';
      if (url.length <= MAX_URL) status = `<span class="pill ok">OK for NFC (≤ ${MAX_URL})</span>`;
      else status = `<span class="pill warn">Over ${MAX_URL} chars — shorten optional fields</span>`;
      out.classList.remove('hide');
      out.innerHTML = `${status}<div style="margin-top:8px"></div><strong>URL:</strong><br>${url}`;
      copyBtn.classList.remove('hide'); openBtn.classList.remove('hide');
      copyBtn.onclick = async ()=>{
        try { await navigator.clipboard.writeText(url);
          copyBtn.textContent = 'Copied!';
          setTimeout(()=>copyBtn.textContent='Copy URL',1200);
        } catch(e){
          alert('Copy failed. Please select and copy manually.');
        }
      };
      openBtn.onclick = ()=> window.open(url, '_blank', 'noopener');
    });

    // Clear
    $('#clear').addEventListener('click', ()=>{
      ['u','n','ph','em','in','li'].forEach(id=>{ const el = document.getElementById(id); if (el) el.value=''; });
      $('#out').classList.add('hide');
      $('#copy').classList.add('hide');
      $('#open').classList.add('hide');
      setLenPill(0);
    });
  </script>
</body>
</html>

