<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Contact Card Generator ‚Ä¢ View-Only Link</title>
  <style>
    :root{
      --bg:hsl(210 20% 98%);
      --card:hsl(0 0% 100%);
      --text:hsl(222 22% 10%);
      --muted:hsl(220 10% 40%);
      --accent:hsl(222 100% 60%);
      --accent-2:hsl(265 90% 62%);
      --ring:hsla(222, 100%, 60%, .25);
      --border:hsl(220 13% 90%);
      --shadow:0 10px 25px rgba(0,0,0,.08), 0 3px 10px rgba(0,0,0,.05);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text); background:linear-gradient(135deg, hsl(210 50% 97%), hsl(260 50% 98%));
    }
    .container{max-width:980px; margin:40px auto; padding:0 16px}
    .header{display:flex; gap:12px; align-items:center; margin-bottom:24px}
    .logo{display:grid; place-items:center; width:42px; height:42px; border-radius:12px; background:linear-gradient(135deg,var(--accent),var(--accent-2)); color:white; font-weight:800; box-shadow:var(--shadow)}
    h1{font-size:clamp(1.25rem, 1rem + 1.2vw, 1.8rem); margin:0}
    .muted{color:var(--muted)}

    .card{background:var(--card); border:1px solid var(--border); border-radius:20px; box-shadow:var(--shadow)}
    .grid{display:grid; gap:20px}

    .form-wrap{padding:24px}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:16px}
    .row-3{display:grid; grid-template-columns:repeat(3, 1fr); gap:16px}
    .row-1{display:grid; grid-template-columns:1fr; gap:16px}

    label{font-size:.9rem; font-weight:600; color:var(--muted)}
    input[type="text"], input[type="email"], input[type="tel"], textarea, input[type="url"]{
      width:100%; padding:12px 14px; font-size:1rem; border-radius:12px; border:1px solid var(--border); background:#fff; outline:none; transition:.15s ease; box-shadow: inset 0 0 0 0 transparent;
    }
    textarea{min-height:96px; resize:vertical}
    input:focus, textarea:focus{border-color:var(--accent); box-shadow:0 0 0 6px var(--ring)}

    .file-input{display:flex; align-items:center; gap:12px; padding:14px; border:1px dashed var(--border); border-radius:12px; background:hsl(0 0% 100% / .8)}
    .file-input input{all:unset}
    .file-input button{padding:8px 12px; border-radius:10px; border:1px solid var(--border); background:linear-gradient(180deg,#fff,hsl(0 0% 98%)); cursor:pointer}

    .actions{display:flex; flex-wrap:wrap; gap:12px; margin-top:8px}
    .btn{appearance:none; border:none; padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:700; box-shadow:var(--shadow)}
    .btn.primary{color:white; background:linear-gradient(135deg,var(--accent),var(--accent-2))}
    .btn.secondary{background:#fff; border:1px solid var(--border)}
    .btn.link{background:transparent; color:var(--accent); padding:10px 0}

    .output{padding:20px; border-top:1px dashed var(--border); background:hsl(0 0% 98% / .6); border-bottom-left-radius:20px; border-bottom-right-radius:20px}
    .output code{display:block; padding:12px; background:#fff; border:1px solid var(--border); border-radius:10px; overflow:auto}

    /* VIEW MODE */
    .view{display:grid; gap:20px; align-items:start; padding:24px}
    .profile{
      display:grid; grid-template-columns:120px 1fr; gap:18px; align-items:center;
      padding:16px; border:1px solid var(--border); border-radius:16px; background:#fff;
    }
    .avatar{width:120px; height:120px; border-radius:16px; object-fit:cover; border:1px solid var(--border)}
    .name{font-size:1.4rem; font-weight:800}
    .info{display:grid; gap:6px}
    .badge{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; border:1px solid var(--border); background:hsl(0 0% 100%)}
    .pill{display:inline-block; padding:6px 10px; border-radius:999px; background:hsl(222 100% 60% / .08); color:var(--accent); font-weight:600; margin-right:6px; margin-bottom:6px}
    .stack{display:flex; flex-wrap:wrap; gap:8px}

    .toolbar{display:flex; flex-wrap:wrap; gap:10px}
    .divider{height:1px; background:var(--border); margin:6px 0}

    .footnote{font-size:.9rem; color:var(--muted)}

    @media (max-width:720px){
      .row, .row-3{grid-template-columns:1fr}
      .profile{grid-template-columns:1fr}
      .avatar{justify-self:center}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">CC</div>
      <div>
        <h1>Contact Card ‚Ä¢ View-Only Link Generator</h1>
        <div class="muted">Fill the form to create a shareable link that shows a read‚Äëonly contact card.</div>
      </div>
    </div>

    <!-- EDIT MODE -->
    <section id="editSection" class="card" hidden>
      <div class="form-wrap grid">
        <div class="row">
          <div>
            <label for="fullName">Full Name</label>
            <input id="fullName" type="text" placeholder="Jane Doe" autocomplete="name" />
          </div>
          <div>
            <label for="phone">Phone Number</label>
            <input id="phone" type="tel" placeholder="(555) 123-4567" autocomplete="tel" />
          </div>
        </div>
        <div class="row">
          <div>
            <label for="email">Email</label>
            <input id="email" type="email" placeholder="jane@example.com" autocomplete="email" />
          </div>
          <div>
            <label for="linkedin">LinkedIn Profile URL</label>
            <input id="linkedin" type="url" placeholder="https://www.linkedin.com/in/janedoe" />
          </div>
        </div>
        <div class="row-1">
          <div>
            <label for="interests">Interests (comma or line‚Äëseparated)</label>
            <textarea id="interests" placeholder="Aerospace, Robotics, Outreach"></textarea>
          </div>
        </div>
        <div class="row-1">
          <label>Profile Picture</label>
          <div class="file-input">
            <button type="button" id="pick">Choose Image</button>
            <span id="pickLabel" class="muted">JPG or PNG. We'll resize for a compact link.</span>
            <input id="photo" type="file" accept="image/*" hidden />
          </div>
        </div>
        <div class="actions">
          <button class="btn secondary" id="previewBtn" type="button">Preview Card</button>
          <button class="btn primary" id="generateBtn" type="button">Generate View‚ÄëOnly Link</button>
          <button class="btn link" id="clearBtn" type="button">Reset</button>
        </div>
      </div>
      <div class="output" id="linkOutput" hidden>
        <div class="muted" style="margin-bottom:8px">Share this view‚Äëonly link:</div>
        <code id="generatedUrl"></code>
        <div class="actions" style="margin-top:12px">
          <button class="btn secondary" id="copyLink" type="button">Copy Link</button>
          <a id="openLink" class="btn primary" href="#" target="_blank" rel="noopener">Open View</a>
        </div>
      </div>
    </section>

    <!-- VIEW MODE -->
    <section id="viewSection" class="card" hidden>
      <div class="view">
        <div class="profile">
          <img id="vPhoto" class="avatar" alt="Profile photo" />
          <div class="info">
            <div class="name" id="vName">Full Name</div>
            <div class="stack">
              <span class="badge" id="vPhone">üìû <span></span></span>
              <span class="badge" id="vEmail">‚úâÔ∏è <span></span></span>
              <a class="badge" id="vLinkedIn" href="#" target="_blank" rel="noopener">üîó <span>LinkedIn</span></a>
            </div>
          </div>
        </div>
        <div>
          <div style="font-weight:700; margin-bottom:6px">Interests</div>
          <div id="vInterests"></div>
        </div>
        <div class="divider"></div>
        <div class="toolbar">
          <a id="downloadVcf" class="btn secondary" download="contact.vcf">Download vCard (.vcf)</a>
          <button id="copyCardLink" class="btn primary" type="button">Copy Card Link</button>
        </div>
        <div class="footnote">This page is view‚Äëonly. To create a new card, open the file and fill the form.</div>
      </div>
    </section>
  </div>

  <script>
    // --- Utilities ---
    const $ = (sel) => document.querySelector(sel);

    // Base64 for Unicode strings
    function b64EncodeUnicode(str){
      return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (m,p)=>String.fromCharCode('0x'+p)));
    }
    function b64DecodeUnicode(str){
      return decodeURIComponent(Array.prototype.map.call(atob(str), c=> '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
    }

    // Resize image to keep URLs small (default 256x256)
    async function resizeImageToDataURL(file, max=256, quality=0.75){
      if(!file) return '';
      const img = new Image();
      const blobURL = URL.createObjectURL(file);
      await new Promise((res, rej)=>{ img.onload=()=>res(); img.onerror=rej; img.src=blobURL; });
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      const {width, height} = img;
      const scale = Math.min(max/width, max/height, 1);
      canvas.width = Math.round(width*scale);
      canvas.height = Math.round(height*scale);
      ctx.fillStyle = '#fff'; // for JPEG background
      ctx.fillRect(0,0,canvas.width, canvas.height);
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      URL.revokeObjectURL(blobURL);
      return canvas.toDataURL('image/jpeg', quality);
    }

    // Parse query and hash payload
    function getQuery(){
      return new URLSearchParams(location.search);
    }

    function buildViewURL(payloadB64){
      const url = new URL(location.href);
      url.search = '?view=1';
      url.hash = payloadB64 ? ('#' + payloadB64) : '';
      return url.toString();
    }

    function payloadFromInputs(){
      const name = $('#fullName').value.trim();
      const phone = $('#phone').value.trim();
      const email = $('#email').value.trim();
      let linkedin = $('#linkedin').value.trim();
      if (linkedin && !/^https?:\/\//i.test(linkedin)) linkedin = 'https://' + linkedin;
      const interestsRaw = $('#interests').value.trim();
      const interests = interestsRaw ? Array.from(new Set(interestsRaw.split(/[,\n]/).map(s=>s.trim()).filter(Boolean))) : [];
      return { name, phone, email, linkedin, interests };
    }

    function validate(payload){
      const errors=[];
      if(!payload.name) errors.push('Full Name is required');
      if(payload.email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(payload.email)) errors.push('Email looks invalid');
      if(payload.linkedin && !/^https?:\/\//i.test(payload.linkedin)) errors.push('LinkedIn URL must start with http(s)');
      return errors;
    }

    function toggle(section){
      $('#editSection').hidden = section !== 'edit';
      $('#viewSection').hidden = section !== 'view';
    }

    function renderView(payload){
      $('#vName').textContent = payload.name || 'Unnamed';
      const phoneSpan = $('#vPhone span');
      const emailSpan = $('#vEmail span');
      const phoneBadge = $('#vPhone');
      const emailBadge = $('#vEmail');
      const li = $('#vLinkedIn');

      if(payload.phone){ phoneSpan.textContent = payload.phone; phoneBadge.style.display='inline-flex'; }
      else { phoneBadge.style.display='none'; }

      if(payload.email){ emailSpan.textContent = payload.email; emailBadge.style.display='inline-flex'; }
      else { emailBadge.style.display='none'; }

      if(payload.linkedin){ li.href = payload.linkedin; li.style.display='inline-flex'; }
      else { li.style.display='none'; }

      const vInt = $('#vInterests');
      vInt.innerHTML = '';
      (payload.interests||[]).forEach(tag=>{
        const span = document.createElement('span');
        span.className = 'pill';
        span.textContent = tag;
        vInt.appendChild(span);
      });

      const img = $('#vPhoto');
      if(payload.photo){ img.src = payload.photo; img.style.display='block'; }
      else { img.src=''; img.style.display='none'; }

      // vCard download link
      const vcf = [
        'BEGIN:VCARD',
        'VERSION:3.0',
        `FN:${(payload.name||'').replace(/,/g,'\\,')}`,
        payload.phone ? `TEL;TYPE=CELL:${payload.phone}` : '',
        payload.email ? `EMAIL;TYPE=INTERNET:${payload.email}` : '',
        payload.linkedin ? `URL:${payload.linkedin}` : '',
        'END:VCARD'
      ].filter(Boolean).join('\n');
      $('#downloadVcf').href = 'data:text/vcard;charset=utf-8,' + encodeURIComponent(vcf);

      // copy link button
      $('#copyCardLink').onclick = async () => {
        try{ await navigator.clipboard.writeText(location.href); alert('Card link copied!'); }
        catch{ prompt('Copy this link:', location.href); }
      };
    }

    async function init(){
      const isView = getQuery().get('view') === '1';
      if(isView){
        toggle('view');
        const hash = location.hash.startsWith('#') ? location.hash.slice(1) : '';
        try{
          const json = b64DecodeUnicode(hash || '');
          const payload = JSON.parse(json || '{}');
          renderView(payload);
        }catch(e){
          // Fallback: no payload
          renderView({});
        }
        return;
      }

      // EDIT MODE
      toggle('edit');

      // File picker proxy
      $('#pick').onclick = () => $('#photo').click();
      $('#photo').addEventListener('change', () => {
        const f = $('#photo').files[0];
        $('#pickLabel').textContent = f ? `${f.name} ‚Ä¢ ${(f.size/1024|0)} KB` : 'JPG or PNG. We\'ll resize for a compact link.';
      });

      // Preview button
      $('#previewBtn').onclick = async () => {
        const base = payloadFromInputs();
        const errors = validate(base);
        if(errors.length){ alert(errors.join('\n')); return; }
        const f = $('#photo').files[0];
        const photo = await resizeImageToDataURL(f);
        const payload = {...base, photo};
        renderView(payload);
        toggle('view');
        history.replaceState(null, '', buildViewURL(b64EncodeUnicode(JSON.stringify(payload))));
      };

      // Generate button
      $('#generateBtn').onclick = async () => {
        const base = payloadFromInputs();
        const errors = validate(base);
        if(errors.length){ alert(errors.join('\n')); return; }
        const f = $('#photo').files[0];
        const photo = await resizeImageToDataURL(f);
        const payload = {...base, photo};
        const b64 = b64EncodeUnicode(JSON.stringify(payload));
        const link = buildViewURL(b64);
        $('#generatedUrl').textContent = link;
        $('#openLink').href = link;
        $('#linkOutput').hidden = false;
        try{ await navigator.clipboard.writeText(link); }catch{}
      };

      // Copy link
      $('#copyLink').onclick = async ()=>{
        const link = $('#generatedUrl').textContent;
        if(!link) return;
        try{ await navigator.clipboard.writeText(link); alert('Link copied!'); }
        catch{ prompt('Copy this link:', link); }
      };

      // Reset
      $('#clearBtn').onclick = ()=>{ 
        ['fullName','phone','email','linkedin','interests'].forEach(id=>$('#'+id).value='');
        $('#photo').value='';
        $('#pickLabel').textContent='JPG or PNG. We\'ll resize for a compact link.';
        $('#linkOutput').hidden = true;
      };
    }

    init();
  </script>
</body>
</html>

